{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ artista.nombre }} - Music App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'music/css/artista.css' %}">
</head>

<body>
    <!-- Navegación superior -->
    <nav class="top-nav">
        <button class="nav-back" onclick="window.history.back()">
            <i class="bi bi-chevron-left"></i>
        </button>
        <div style="flex: 1;"></div>
    </nav>

    <!-- Header del artista -->
    <div class="artist-header">
        <div class="artist-info">
            {% if artista.imagen %}
            <img src="{{ artista.imagen.url }}" alt="{{ artista.nombre }}" class="artist-image">
            {% else %}
            <div class="artist-image-placeholder">
                {{ artista.nombre.0|upper }}
            </div>
            {% endif %}

            <div class="artist-details">
                <div class="artist-stats">
                    <i class="bi bi-patch-check-fill verified-badge"></i>
                    <span>Artista verificado</span>
                </div>
                <h1>{{ artista.nombre }}</h1>
                <div class="artist-stats">
                    <span>{{ total_canciones }} canción{{ total_canciones|pluralize:"es" }}</span>
                    <span>•</span>
                    <span>{{ total_albums }} álbum{{ total_albums|pluralize:"es" }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Acciones del artista -->
    <div class="artist-actions">
        {% if canciones %}
        <button class="btn-play" onclick="playFirstSong()">
            <i class="bi bi-play-fill"></i>
        </button>
        {% endif %}
        <button class="btn-follow">Seguir</button>
        <button class="btn-more">
            <i class="bi bi-three-dots"></i>
        </button>
    </div>

    <!-- Contenido principal -->
    <div class="artist-content">
        <!-- Canciones populares -->
        <div class="section-title">Populares</div>

        {% if canciones %}
        <ul class="song-list">
            {% for cancion in canciones|slice:":10" %}
            <li class="song-item" onclick="playSong({{ cancion.id }})">
                <div style="position: relative; text-align: center;">
                    <span class="song-number">{{ forloop.counter }}</span>
                    <i class="bi bi-play-fill song-play-icon"></i>
                </div>

                <div class="song-info">
                    {% if cancion.portada %}
                    <img src="{{ cancion.get_portada }}" alt="{{ cancion.titulo }}" class="song-cover">
                    {% else %}
                    <div class="song-cover-placeholder">
                        <i class="bi bi-music-note"></i>
                    </div>
                    {% endif %}
                    <div class="song-details">
                        <h4>{{ cancion.titulo }}</h4>
                        <p>{{ cancion.reproducciones|default:0 }} reproducciones</p>
                    </div>
                </div>

                <a href="{% if cancion.album %}{% url 'album_detalle' cancion.album.id %}{% else %}#{% endif %}"
                    class="song-album" onclick="event.stopPropagation()">
                    {{ cancion.album.titulo|default:"Sencillo" }}
                </a>

                <div style="display: flex; align-items: center; gap: 16px; justify-content: flex-end;">
                    <i class="bi bi-heart song-like"></i>
                    <span class="song-duration">{{ cancion.duracion_formateada }}</span>
                </div>
            </li>
            {% endfor %}
        </ul>

        {% if canciones.count > 10 %}
        <button class="btn-follow" style="margin-top: 16px;">
            Ver más
        </button>
        {% endif %}
        {% else %}
        <div class="empty-state">
            <i class="bi bi-music-note-list"></i>
            <h3>No hay canciones disponibles</h3>
            <p>Este artista aún no tiene canciones publicadas.</p>
        </div>
        {% endif %}

        <!-- Álbumes -->
        {% if albums %}
        <div class="section-title" style="margin-top: 48px;">Discografía</div>
        <div class="albums-grid">
            {% for album in albums %}
            <div class="album-card" onclick="window.location.href='{% url 'album_detalle' album.id %}'">
                {% if album.portada %}
                <img src="{{ album.portada.url }}" alt="{{ album.titulo }}" class="album-cover">
                {% else %}
                <div class="album-cover-placeholder">
                    <i class="bi bi-disc"></i>
                </div>
                {% endif %}

                <button class="album-play-btn" onclick="event.stopPropagation(); playAlbum({{ album.id }})">
                    <i class="bi bi-play-fill"></i>
                </button>

                <h3 class="album-title">{{ album.titulo }}</h3>
                <p class="album-info">
                    {% if album.fecha_lanzamiento %}
                    {{ album.fecha_lanzamiento.year }} • Álbum
                    {% else %}
                    Álbum
                    {% endif %}
                </p>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Biografía -->
        {% if artista.biografia %}
        <div class="biography">
            <h3>Acerca de</h3>
            <p>{{ artista.biografia }}</p>
        </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function playSong(songId) {
            // Redirigir al reproductor con la canción seleccionada
            window.location.href = `/player/?id=${songId}`;
        }

        function playFirstSong() {
            {% if canciones %}
            playSong({{ canciones.first.id }});
        {% endif %}
        }

        function playAlbum(albumId) {
            // Aquí podrías implementar la lógica para reproducir todo el álbum
            window.location.href = `/album/${albumId}/`;
        }

        // Efecto parallax suave en el header
        window.addEventListener('scroll', () => {
            const header = document.querySelector('.artist-header');
            const scrolled = window.pageYOffset;
            header.style.transform = `translateY(${scrolled * 0.5}px)`;
        });
    </script>
</body>

</html>